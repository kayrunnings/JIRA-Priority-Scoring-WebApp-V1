<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSJF Enterprise Prioritization System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }
        
        /* Authentication Styles */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .auth-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 420px;
            padding: 40px;
        }
        
        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .auth-logo p {
            color: #718096;
            font-size: 14px;
        }
        
        .auth-form {
            margin-top: 30px;
        }
        
        .auth-input-group {
            margin-bottom: 20px;
        }
        
        .auth-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .auth-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .auth-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .auth-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #718096;
        }
        
        .auth-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Main App Styles */
        .app-container {
            min-height: 100vh;
            background: #f0f2f5;
        }
        
        .app-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .app-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logout-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            color: #4a5568;
            font-size: 14px;
            cursor: pointer;
        }
        
        .logout-btn:hover {
            background: #f7fafc;
        }
        
        /* Navigation */
        .nav-tabs {
            background: white;
            padding: 0 24px;
            display: flex;
            gap: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .nav-tab {
            padding: 16px 20px;
            border: none;
            background: transparent;
            color: #718096;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab:hover {
            color: #4a5568;
            background: #f7fafc;
        }
        
        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        /* Content */
        .content-area {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 13px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #f7fafc;
        }
        
        /* Table */
        .data-table {
            width: 100%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #f7fafc;
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #4a5568;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .data-table td {
            padding: 12px 16px;
            font-size: 14px;
            color: #2d3748;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .data-table tr:hover {
            background: #f7fafc;
        }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-fire {
            background: #f56565;
            color: white;
        }
        
        .badge-critical {
            background: #ed8936;
            color: white;
        }
        
        .badge-high {
            background: #ecc94b;
            color: white;
        }
        
        .badge-medium {
            background: #4299e1;
            color: white;
        }
        
        .badge-low {
            background: #a0aec0;
            color: white;
        }
        
        .demo-banner {
            background: linear-gradient(135deg, #f6e05e, #ecc94b);
            color: #744210;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .action-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.success {
            border-left: 4px solid #48bb78;
        }
        
        .notification.error {
            border-left: 4px solid #f56565;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: #718096;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // Simple Backend Service
        class BackendService {
            constructor() {
                this.tickets = this.loadTickets();
                this.config = this.loadConfig();
            }
            
            loadTickets() {
                const stored = localStorage.getItem('wsjf_tickets');
                return stored ? JSON.parse(stored) : this.generateSampleTickets();
            }
            
            saveTickets(tickets) {
                localStorage.setItem('wsjf_tickets', JSON.stringify(tickets));
                this.tickets = tickets;
            }
            
            loadConfig() {
                const stored = localStorage.getItem('wsjf_config');
                return stored ? JSON.parse(stored) : this.getDefaultConfig();
            }
            
            saveConfig(config) {
                localStorage.setItem('wsjf_config', JSON.stringify(config));
                this.config = config;
            }
            
            getDefaultConfig() {
                return {
                    severityScores: {
                        'Level 5 - FIRE': 21,
                        'Level 4 - Critical': 13,
                        'Level 3 - High': 8,
                        'Level 2 - Medium': 5,
                        'Level 1 - Low': 3
                    },
                    weights: {
                        businessValue: 0.4,
                        timeCriticality: 0.3,
                        rrOe: 0.3
                    }
                };
            }
            
            generateSampleTickets() {
                return [
                    {
                        key: 'DEMO-1001',
                        summary: 'Critical payment gateway timeout affecting enterprise clients',
                        severity: 'Level 5 - FIRE',
                        issueValue: 75000,
                        enterpriseAccounts: 12,
                        flaggedAccounts: 5,
                        dueDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        marketTiming: 'Pointless afterwards',
                        rrOeValue: 13,
                        storyPoints: 8,
                        status: 'In Progress'
                    },
                    {
                        key: 'DEMO-1002',
                        summary: 'Dashboard performance optimization',
                        severity: 'Level 3 - High',
                        issueValue: 25000,
                        enterpriseAccounts: 3,
                        flaggedAccounts: 1,
                        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        marketTiming: 'Slowly degrading',
                        rrOeValue: 5,
                        storyPoints: 5,
                        status: 'To Do'
                    },
                    {
                        key: 'DEMO-1003',
                        summary: 'Implement GDPR compliance module',
                        severity: 'Level 4 - Critical',
                        issueValue: 50000,
                        enterpriseAccounts: 8,
                        flaggedAccounts: 3,
                        dueDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        marketTiming: 'Drops steeply',
                        rrOeValue: 8,
                        storyPoints: 13,
                        status: 'In Review'
                    }
                ];
            }
            
            calculateWSJF(ticket, config) {
                const severityScore = config.severityScores[ticket.severity] || 0;
                const clientCountBonus = ticket.issueValue / 1000;
                
                let strategicTierBonus = 0;
                if (ticket.enterpriseAccounts > 0 && ticket.flaggedAccounts > 0) {
                    strategicTierBonus = 5;
                } else if (ticket.flaggedAccounts > 0) {
                    strategicTierBonus = 3;
                } else if (ticket.enterpriseAccounts > 0) {
                    strategicTierBonus = 2;
                }
                
                const businessValue = (severityScore + clientCountBonus + strategicTierBonus) * config.weights.businessValue;
                const timeCriticality = 10 * config.weights.timeCriticality;
                const rrOe = ticket.rrOeValue * config.weights.rrOe;
                
                const costOfDelay = Math.round(businessValue + timeCriticality + rrOe);
                const wsjfScore = (costOfDelay / ticket.storyPoints) * 10;
                
                return {
                    wsjfScore: wsjfScore.toFixed(2),
                    costOfDelay
                };
            }
        }
        
        const backend = new BackendService();
        
        // Authentication Component
        function LoginForm({ onLogin }) {
            const [email, setEmail] = useState('demo@company.com');
            const [password, setPassword] = useState('demo123');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (email && password) {
                    onLogin({ email, name: 'Demo User' });
                }
            };
            
            return (
                <div className="auth-container">
                    <div className="auth-card">
                        <div className="auth-logo">
                            <h1>WSJF Enterprise</h1>
                            <p>Prioritization System</p>
                        </div>
                        
                        <form className="auth-form" onSubmit={handleSubmit}>
                            <div className="auth-input-group">
                                <label className="auth-label">Email Address</label>
                                <input
                                    type="email"
                                    className="auth-input"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <div className="auth-input-group">
                                <label className="auth-label">Password</label>
                                <input
                                    type="password"
                                    className="auth-input"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <button type="submit" className="auth-btn">Sign In</button>
                        </form>
                        
                        <div style={{ marginTop: 20, padding: 15, background: '#f7fafc', borderRadius: 8 }}>
                            <p style={{ fontSize: 12, color: '#718096', textAlign: 'center' }}>
                                Demo Credentials:<br/>
                                Email: demo@company.com<br/>
                                Password: demo123
                            </p>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Notification Component
        function Notification({ message, type, onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);
            
            return (
                <div className={`notification ${type}`}>
                    {message}
                </div>
            );
        }
        
        // Main App Component
        function MainApp({ user, onLogout }) {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [tickets, setTickets] = useState(backend.tickets);
            const [config] = useState(backend.config);
            const [loading, setLoading] = useState(false);
            const [notification, setNotification] = useState(null);
            const [lastImport, setLastImport] = useState(null);
            const [lastCalc, setLastCalc] = useState(null);
            
            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
            };
            
            const handleImport = async () => {
                setLoading(true);
                // Simulate API call
                setTimeout(() => {
                    const newTickets = [
                        {
                            key: `JIRA-${Date.now()}`,
                            summary: 'Imported ticket from JIRA',
                            severity: 'Level 3 - High',
                            issueValue: 30000,
                            enterpriseAccounts: 4,
                            flaggedAccounts: 2,
                            dueDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            marketTiming: 'Slowly degrading',
                            rrOeValue: 6,
                            storyPoints: 5,
                            status: 'To Do'
                        }
                    ];
                    setTickets([...tickets, ...newTickets]);
                    backend.saveTickets([...tickets, ...newTickets]);
                    setLastImport(new Date());
                    setLoading(false);
                    showNotification('Successfully imported 1 ticket from JIRA');
                }, 1500);
            };
            
            const handleRecalculate = () => {
                setLastCalc(new Date());
                setTickets([...tickets]); // Force re-render
                showNotification('WSJF scores recalculated');
            };
            
            const handleDelete = (key) => {
                const updated = tickets.filter(t => t.key !== key);
                setTickets(updated);
                backend.saveTickets(updated);
                showNotification('Ticket deleted');
            };
            
            const processedTickets = useMemo(() => {
                return tickets.map(ticket => {
                    const calculations = backend.calculateWSJF(ticket, config);
                    return { ...ticket, ...calculations };
                }).sort((a, b) => parseFloat(b.wsjfScore) - parseFloat(a.wsjfScore));
            }, [tickets, config]);
            
            const stats = {
                total: processedTickets.length,
                avgWSJF: processedTickets.reduce((sum, t) => sum + parseFloat(t.wsjfScore), 0) / processedTickets.length || 0,
                totalPoints: processedTickets.reduce((sum, t) => sum + t.storyPoints, 0),
                critical: processedTickets.filter(t => t.severity.includes('Critical') || t.severity.includes('FIRE')).length
            };
            
            const getSeverityBadge = (severity) => {
                if (severity.includes('FIRE')) return 'badge-fire';
                if (severity.includes('Critical')) return 'badge-critical';
                if (severity.includes('High')) return 'badge-high';
                if (severity.includes('Medium')) return 'badge-medium';
                return 'badge-low';
            };
            
            const formatTime = (date) => {
                if (!date) return 'Never';
                const diff = new Date() - date;
                const mins = Math.floor(diff / 60000);
                if (mins < 1) return 'Just now';
                if (mins < 60) return `${mins}m ago`;
                return `${Math.floor(mins / 60)}h ago`;
            };
            
            return (
                <div className="app-container">
                    {notification && (
                        <Notification
                            message={notification.message}
                            type={notification.type}
                            onClose={() => setNotification(null)}
                        />
                    )}
                    
                    <div className="demo-banner">
                        🎮 DEMO MODE - Using sample data | Last Import: {formatTime(lastImport)} | Last Calculation: {formatTime(lastCalc)}
                    </div>
                    
                    <div className="app-header">
                        <h1 className="app-title">WSJF Enterprise System</h1>
                        <div className="user-menu">
                            <span>Welcome, {user.name}</span>
                            <button className="logout-btn" onClick={onLogout}>Logout</button>
                        </div>
                    </div>
                    
                    <div className="nav-tabs">
                        <button className={`nav-tab ${activeTab === 'dashboard' ? 'active' : ''}`} onClick={() => setActiveTab('dashboard')}>
                            Dashboard
                        </button>
                        <button className={`nav-tab ${activeTab === 'config' ? 'active' : ''}`} onClick={() => setActiveTab('config')}>
                            Configuration
                        </button>
                    </div>
                    
                    <div className="content-area">
                        {loading && (
                            <div className="loading">
                                <div className="spinner"></div>
                                <p>Loading...</p>
                            </div>
                        )}
                        
                        {!loading && activeTab === 'dashboard' && (
                            <>
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.total}</div>
                                        <div className="stat-label">Total Tickets</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.avgWSJF.toFixed(1)}</div>
                                        <div className="stat-label">Average WSJF</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.totalPoints}</div>
                                        <div className="stat-label">Story Points</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.critical}</div>
                                        <div className="stat-label">Critical/Fire</div>
                                    </div>
                                </div>
                                
                                <div className="action-bar">
                                    <button className="btn btn-primary" onClick={handleImport}>
                                        📥 Import from JIRA
                                    </button>
                                    <button className="btn btn-success" onClick={handleRecalculate}>
                                        🔄 Recalculate WSJF
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => {
                                        const csv = [
                                            ['Rank', 'Key', 'Summary', 'WSJF Score', 'Cost of Delay', 'Points', 'Severity'],
                                            ...processedTickets.map((t, i) => [
                                                i + 1, t.key, t.summary, t.wsjfScore, t.costOfDelay, t.storyPoints, t.severity
                                            ])
                                        ].map(row => row.join(',')).join('\n');
                                        
                                        const blob = new Blob([csv], { type: 'text/csv' });
                                        const url = URL.createObjectURL(blob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = 'wsjf_export.csv';
                                        a.click();
                                        showNotification('Export completed');
                                    }}>
                                        📤 Export CSV
                                    </button>
                                </div>
                                
                                <table className="data-table">
                                    <thead>
                                        <tr>
                                            <th>Rank</th>
                                            <th>Key</th>
                                            <th>Summary</th>
                                            <th>WSJF Score</th>
                                            <th>Cost of Delay</th>
                                            <th>Points</th>
                                            <th>Severity</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {processedTickets.map((ticket, index) => (
                                            <tr key={ticket.key}>
                                                <td><strong>#{index + 1}</strong></td>
                                                <td><strong>{ticket.key}</strong></td>
                                                <td>{ticket.summary}</td>
                                                <td><strong style={{ color: '#667eea' }}>{ticket.wsjfScore}</strong></td>
                                                <td>{ticket.costOfDelay}</td>
                                                <td>{ticket.storyPoints}</td>
                                                <td>
                                                    <span className={`badge ${getSeverityBadge(ticket.severity)}`}>
                                                        {ticket.severity.split(' - ')[1]}
                                                    </span>
                                                </td>
                                                <td>{ticket.status}</td>
                                                <td>
                                                    <button 
                                                        className="btn btn-secondary"
                                                        style={{ padding: '6px 12px', fontSize: '12px' }}
                                                        onClick={() => handleDelete(ticket.key)}
                                                    >
                                                        Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </>
                        )}
                        
                        {!loading && activeTab === 'config' && (
                            <div style={{ background: 'white', padding: 24, borderRadius: 12 }}>
                                <h2 style={{ marginBottom: 20 }}>Configuration</h2>
                                <p>WSJF Scoring Configuration</p>
                                <div style={{ marginTop: 20 }}>
                                    <h3>Severity Scores</h3>
                                    {Object.entries(config.severityScores).map(([level, score]) => (
                                        <div key={level} style={{ marginBottom: 10 }}>
                                            <label>{level}: {score}</label>
                                        </div>
                                    ))}
                                </div>
                                <div style={{ marginTop: 20 }}>
                                    <h3>Weights</h3>
                                    <div>Business Value: {config.weights.businessValue}</div>
                                    <div>Time Criticality: {config.weights.timeCriticality}</div>
                                    <div>RR/OE: {config.weights.rrOe}</div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // Root App Component
        function App() {
            const [user, setUser] = useState(null);
            
            if (!user) {
                return <LoginForm onLogin={setUser} />;
            }
            
            return <MainApp user={user} onLogout={() => setUser(null)} />;
        }
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
