<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSJF Prioritization System</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .header-stat {
            text-align: center;
        }
        
        .header-stat-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .header-stat-label {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tabs {
            background: white;
            padding: 0;
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            overflow-x: auto;
        }
        
        .tab {
            padding: 20px 30px;
            border: none;
            background: transparent;
            color: #4a5568;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
        }
        
        .tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .tab.active {
            color: #667eea;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .content {
            padding: 30px;
            min-height: 500px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 5px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            color: white;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .table th {
            background: #f7fafc;
            padding: 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 700;
            color: #2d3748;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .table td {
            padding: 15px;
            font-size: 14px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .table tr:hover {
            background: rgba(102, 126, 234, 0.02);
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-fire {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }
        
        .badge-critical {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }
        
        .badge-high {
            background: linear-gradient(135deg, #ecc94b, #d69e2e);
            color: white;
        }
        
        .badge-medium {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }
        
        .badge-low {
            background: linear-gradient(135deg, #a0aec0, #718096);
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 13px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .grid {
            display: grid;
            gap: 20px;
        }
        
        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        }
        
        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #63b3ed20, #4299e120);
            color: #2c5282;
            border: 1px solid #4299e140;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #f6e05e20, #ecc94b20);
            color: #744210;
            border: 1px solid #ecc94b40;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #68d39120, #48bb7820);
            color: #22543d;
            border: 1px solid #48bb7840;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
        }
        
        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 16px 24px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
            z-index: 1000;
            font-weight: 600;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .formula-box {
            background: linear-gradient(135deg, #edf2f7, #e2e8f0);
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin-bottom: 25px;
            color: #2d3748;
        }
        
        .config-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .config-row:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }
        
        .config-label {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .config-input {
            width: 100px;
            padding: 8px 12px;
            border: 2px solid #cbd5e0;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            background: white;
        }
        
        .mode-toggle {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            padding: 8px 16px;
            border: 2px solid #cbd5e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .api-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .api-status.connected {
            background: #c6f6d5;
            color: #276749;
        }
        
        .api-status.disconnected {
            background: #fed7d7;
            color: #9b2c2c;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // JIRA API Service
        class JiraAPIService {
            constructor() {
                this.apiEnabled = false;
            }
            
            async checkAPIConnection() {
                try {
                    const response = await fetch('/api/jira/health', {
                        method: 'GET'
                    });
                    return response.ok;
                } catch (error) {
                    console.log('API not available, using demo mode');
                    return false;
                }
            }
            
            async fetchTicketsByKeys(keys) {
                if (!this.apiEnabled) {
                    return this.getMockTickets(keys);
                }
                
                try {
                    const response = await fetch('/api/jira', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            type: 'byKeys',
                            keys: keys.split(',').map(k => k.trim())
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('API request failed');
                    }
                    
                    const data = await response.json();
                    return this.transformJiraTickets(data.issues || []);
                } catch (error) {
                    console.error('JIRA API Error:', error);
                    return this.getMockTickets(keys);
                }
            }
            
            async fetchTicketsByJQL(jql) {
                if (!this.apiEnabled) {
                    return this.getMockTickets(jql);
                }
                
                try {
                    const response = await fetch('/api/jira', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            type: 'byJQL',
                            jql: jql
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('API request failed');
                    }
                    
                    const data = await response.json();
                    return this.transformJiraTickets(data.issues || []);
                } catch (error) {
                    console.error('JIRA API Error:', error);
                    return this.getMockTickets(jql);
                }
            }
            
            transformJiraTickets(issues) {
                return issues.map(issue => ({
                    key: issue.key,
                    summary: issue.fields.summary,
                    severity: this.mapPriorityToSeverity(issue.fields.priority?.name),
                    issueValue: issue.fields.customfield_10001 || Math.floor(Math.random() * 30000) + 5000,
                    enterpriseAccounts: issue.fields.customfield_10002 || 0,
                    flaggedAccounts: issue.fields.customfield_10003 || 0,
                    dueDate: issue.fields.duedate || '',
                    marketTiming: issue.fields.customfield_10004 || 'No timing impact',
                    rrOeValue: issue.fields.customfield_10005 || 5,
                    storyPoints: issue.fields.customfield_10006 || 3,
                    createdDate: issue.fields.created,
                    issueType: issue.fields.issuetype?.name || 'Task',
                    status: issue.fields.status?.name || 'To Do'
                }));
            }
            
            mapPriorityToSeverity(priority) {
                const mapping = {
                    'Highest': 'Level 5 - FIRE',
                    'High': 'Level 4 - Critical',
                    'Medium': 'Level 3 - High',
                    'Low': 'Level 2 - Medium',
                    'Lowest': 'Level 1 - Low'
                };
                return mapping[priority] || 'Level 2 - Medium';
            }
            
            getMockTickets(searchTerm) {
                // Generate mock tickets based on search
                return Array(3).fill(null).map((_, i) => ({
                    key: `DEMO-${2000 + i}`,
                    summary: `Sample ticket from search: ${searchTerm.substring(0, 30)}...`,
                    severity: ['Level 2 - Medium', 'Level 3 - High', 'Level 4 - Critical'][i % 3],
                    issueValue: Math.floor(Math.random() * 30000) + 5000,
                    enterpriseAccounts: Math.floor(Math.random() * 8),
                    flaggedAccounts: Math.floor(Math.random() * 4),
                    dueDate: new Date(Date.now() + Math.random() * 45 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    marketTiming: ['No timing impact', 'Slowly degrading', 'Drops steeply'][i % 3],
                    rrOeValue: Math.floor(Math.random() * 10) + 1,
                    storyPoints: Math.floor(Math.random() * 8) + 1,
                    createdDate: new Date().toISOString().split('T')[0],
                    issueType: 'Task',
                    status: 'To Do'
                }));
            }
        }
        
        // Backend Service
        class BackendService {
            constructor() {
                this.tickets = this.loadTickets();
                this.config = this.loadConfig();
                this.jiraAPI = new JiraAPIService();
            }
            
            loadTickets() {
                const stored = localStorage.getItem('wsjf_tickets');
                return stored ? JSON.parse(stored) : this.generateSampleTickets();
            }
            
            saveTickets(tickets) {
                localStorage.setItem('wsjf_tickets', JSON.stringify(tickets));
                this.tickets = tickets;
            }
            
            loadConfig() {
                const stored = localStorage.getItem('wsjf_config');
                return stored ? JSON.parse(stored) : this.getDefaultConfig();
            }
            
            saveConfig(config) {
                localStorage.setItem('wsjf_config', JSON.stringify(config));
                this.config = config;
            }
            
            getDefaultConfig() {
                return {
                    severityScores: {
                        'Level 5 - FIRE': 21,
                        'Level 4 - Critical': 13,
                        'Level 3 - High': 8,
                        'Level 2 - Medium': 5,
                        'Level 1 - Low': 3
                    },
                    dueDateUrgency: {
                        'Overdue': 21,
                        '< 1 week': 13,
                        '1 to 2 weeks': 8,
                        '2 to 4 weeks': 5,
                        '1 to 2 months': 3,
                        '2 to 6 months': 2,
                        'No deadline': 1
                    },
                    marketTimingMultipliers: {
                        'Pointless afterwards': 2.0,
                        'Drops steeply': 1.6,
                        'Slowly degrading': 1.4,
                        'Nice to meet deadline': 1.2,
                        'No timing impact': 1.0
                    },
                    weights: {
                        businessValue: 0.4,
                        timeCriticality: 0.3,
                        rrOe: 0.3
                    },
                    strategicTierBonus: {
                        'Both Enterprise & Flagged': 5,
                        'Only Flagged': 3,
                        'Only Enterprise': 2,
                        'Neither': 0
                    },
                    calculationFactors: {
                        clientCountDivisor: 1000,
                        finalMultiplier: 10
                    }
                };
            }
            
            generateSampleTickets() {
                return [
                    {
                        key: 'DEMO-1001',
                        summary: 'Payment processing timeout for enterprise clients',
                        severity: 'Level 5 - FIRE',
                        issueValue: 45000,
                        enterpriseAccounts: 8,
                        flaggedAccounts: 3,
                        dueDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        marketTiming: 'Pointless afterwards',
                        rrOeValue: 13,
                        storyPoints: 8,
                        createdDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        issueType: 'Bug',
                        status: 'In Progress'
                    },
                    {
                        key: 'DEMO-1002',
                        summary: 'Dashboard performance optimization',
                        severity: 'Level 3 - High',
                        issueValue: 15000,
                        enterpriseAccounts: 2,
                        flaggedAccounts: 0,
                        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        marketTiming: 'Slowly degrading',
                        rrOeValue: 5,
                        storyPoints: 5,
                        createdDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        issueType: 'Improvement',
                        status: 'To Do'
                    },
                    {
                        key: 'DEMO-1003',
                        summary: 'Implement new compliance reporting feature',
                        severity: 'Level 4 - Critical',
                        issueValue: 30000,
                        enterpriseAccounts: 5,
                        flaggedAccounts: 2,
                        dueDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        marketTiming: 'Drops steeply',
                        rrOeValue: 8,
                        storyPoints: 13,
                        createdDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        issueType: 'New Feature',
                        status: 'In Progress'
                    }
                ];
            }
            
            calculateWSJF(ticket, config) {
                const severityScore = config.severityScores[ticket.severity] || 0;
                const clientCountBonus = ticket.issueValue / config.calculationFactors.clientCountDivisor;
                
                let strategicTierBonus = 0;
                if (ticket.enterpriseAccounts > 0 && ticket.flaggedAccounts > 0) {
                    strategicTierBonus = config.strategicTierBonus['Both Enterprise & Flagged'];
                } else if (ticket.flaggedAccounts > 0) {
                    strategicTierBonus = config.strategicTierBonus['Only Flagged'];
                } else if (ticket.enterpriseAccounts > 0) {
                    strategicTierBonus = config.strategicTierBonus['Only Enterprise'];
                } else {
                    strategicTierBonus = config.strategicTierBonus['Neither'];
                }
                
                const weightedBusinessValue = (severityScore + clientCountBonus + strategicTierBonus) * config.weights.businessValue;
                
                let dueDateUrgency = 1;
                if (ticket.dueDate) {
                    const today = new Date();
                    const dueDate = new Date(ticket.dueDate);
                    const daysUntilDue = Math.floor((dueDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysUntilDue < 0) {
                        dueDateUrgency = config.dueDateUrgency['Overdue'];
                    } else if (daysUntilDue < 7) {
                        dueDateUrgency = config.dueDateUrgency['< 1 week'];
                    } else if (daysUntilDue < 14) {
                        dueDateUrgency = config.dueDateUrgency['1 to 2 weeks'];
                    } else if (daysUntilDue < 28) {
                        dueDateUrgency = config.dueDateUrgency['2 to 4 weeks'];
                    } else if (daysUntilDue < 60) {
                        dueDateUrgency = config.dueDateUrgency['1 to 2 months'];
                    } else if (daysUntilDue < 180) {
                        dueDateUrgency = config.dueDateUrgency['2 to 6 months'];
                    } else {
                        dueDateUrgency = config.dueDateUrgency['No deadline'];
                    }
                }
                
                const marketTimingMultiplier = config.marketTimingMultipliers[ticket.marketTiming] || 1.0;
                const weightedTimeCriticality = (dueDateUrgency * marketTimingMultiplier) * config.weights.timeCriticality;
                const weightedRROE = ticket.rrOeValue * config.weights.rrOe;
                const costOfDelay = Math.round(weightedBusinessValue + weightedTimeCriticality + weightedRROE);
                const wsjfScore = (costOfDelay / ticket.storyPoints) * config.calculationFactors.finalMultiplier;
                
                return {
                    wsjfScore: wsjfScore.toFixed(2),
                    costOfDelay,
                    weightedBusinessValue: weightedBusinessValue.toFixed(2),
                    weightedTimeCriticality: weightedTimeCriticality.toFixed(2),
                    weightedRROE: weightedRROE.toFixed(2)
                };
            }
        }
        
        const backend = new BackendService();
        
        // Notification Component
        function Notification({ message, type, onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, []);
            
            return <div className={`notification ${type === 'error' ? 'error' : ''}`}>{message}</div>;
        }
        
        // Main App Component
        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [tickets, setTickets] = useState(backend.tickets);
            const [config, setConfig] = useState(backend.config);
            const [loading, setLoading] = useState(false);
            const [notification, setNotification] = useState(null);
            const [apiConnected, setApiConnected] = useState(false);
            const [mode, setMode] = useState('demo'); // 'demo' or 'jira'
            
            // Import state
            const [importKeys, setImportKeys] = useState('');
            const [jqlQuery, setJqlQuery] = useState('');
            
            // Manual entry state
            const [manualTicket, setManualTicket] = useState({
                key: '',
                summary: '',
                severity: 'Level 2 - Medium',
                issueValue: 0,
                enterpriseAccounts: 0,
                flaggedAccounts: 0,
                dueDate: '',
                marketTiming: 'No timing impact',
                rrOeValue: 5,
                storyPoints: 3,
                createdDate: new Date().toISOString().split('T')[0],
                issueType: 'Bug',
                status: 'To Do'
            });
            
            // Check API connection on mount
            useEffect(() => {
                checkAPIStatus();
            }, []);
            
            const checkAPIStatus = async () => {
                const isConnected = await backend.jiraAPI.checkAPIConnection();
                setApiConnected(isConnected);
                backend.jiraAPI.apiEnabled = isConnected && mode === 'jira';
            };
            
            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
            };
            
            const handleModeChange = (newMode) => {
                setMode(newMode);
                backend.jiraAPI.apiEnabled = newMode === 'jira' && apiConnected;
                if (newMode === 'jira' && !apiConnected) {
                    showNotification('JIRA API not connected. Using demo data.', 'error');
                }
            };
            
            const handleImportByKeys = async () => {
                if (!importKeys) {
                    showNotification('Please enter issue keys', 'error');
                    return;
                }
                setLoading(true);
                try {
                    const newTickets = await backend.jiraAPI.fetchTicketsByKeys(importKeys);
                    const updatedTickets = [...tickets, ...newTickets];
                    backend.saveTickets(updatedTickets);
                    setTickets(updatedTickets);
                    setImportKeys('');
                    showNotification(`Imported ${newTickets.length} tickets successfully`);
                } catch (error) {
                    showNotification(`Error: ${error.message}`, 'error');
                }
                setLoading(false);
            };
            
            const handleImportByJQL = async () => {
                if (!jqlQuery) {
                    showNotification('Please enter a JQL query', 'error');
                    return;
                }
                setLoading(true);
                try {
                    const newTickets = await backend.jiraAPI.fetchTicketsByJQL(jqlQuery);
                    const updatedTickets = [...tickets, ...newTickets];
                    backend.saveTickets(updatedTickets);
                    setTickets(updatedTickets);
                    setJqlQuery('');
                    showNotification(`Imported ${newTickets.length} tickets via JQL`);
                } catch (error) {
                    showNotification(`Error: ${error.message}`, 'error');
                }
                setLoading(false);
            };
            
            const handleManualSubmit = () => {
                if (!manualTicket.key || !manualTicket.summary) {
                    showNotification('Please provide Key and Summary', 'error');
                    return;
                }
                
                const updatedTickets = [...tickets, manualTicket];
                backend.saveTickets(updatedTickets);
                setTickets(updatedTickets);
                
                setManualTicket({
                    key: '',
                    summary: '',
                    severity: 'Level 2 - Medium',
                    issueValue: 0,
                    enterpriseAccounts: 0,
                    flaggedAccounts: 0,
                    dueDate: '',
                    marketTiming: 'No timing impact',
                    rrOeValue: 5,
                    storyPoints: 3,
                    createdDate: new Date().toISOString().split('T')[0],
                    issueType: 'Bug',
                    status: 'To Do'
                });
                
                showNotification('Ticket added successfully');
                setActiveTab('dashboard');
            };
            
            const handleConfigUpdate = (section, key, value) => {
                const newConfig = { ...config };
                const keys = section.split('.');
                let target = newConfig;
                
                for (let i = 0; i < keys.length - 1; i++) {
                    target = target[keys[i]];
                }
                
                target[keys[keys.length - 1]][key] = isNaN(value) ? value : parseFloat(value);
                backend.saveConfig(newConfig);
                setConfig(newConfig);
                showNotification('Configuration updated');
            };
            
            const handleDeleteTicket = (key) => {
                const updatedTickets = tickets.filter(t => t.key !== key);
                backend.saveTickets(updatedTickets);
                setTickets(updatedTickets);
                showNotification('Ticket deleted');
            };
            
            const calculatePrioritizedTickets = () => {
                return tickets.map(ticket => {
                    const calculations = backend.calculateWSJF(ticket, config);
                    return { ...ticket, ...calculations };
                }).sort((a, b) => parseFloat(b.wsjfScore) - parseFloat(a.wsjfScore));
            };
            
            const prioritizedTickets = calculatePrioritizedTickets();
            
            const stats = {
                total: prioritizedTickets.length,
                avgWSJF: prioritizedTickets.reduce((sum, t) => sum + parseFloat(t.wsjfScore), 0) / prioritizedTickets.length || 0,
                totalPoints: prioritizedTickets.reduce((sum, t) => sum + t.storyPoints, 0),
                critical: prioritizedTickets.filter(t => t.severity.includes('Critical') || t.severity.includes('FIRE')).length
            };
            
            const getSeverityBadgeClass = (severity) => {
                if (severity.includes('FIRE')) return 'badge-fire';
                if (severity.includes('Critical')) return 'badge-critical';
                if (severity.includes('High')) return 'badge-high';
                if (severity.includes('Medium')) return 'badge-medium';
                return 'badge-low';
            };
            
            const exportToCSV = () => {
                const headers = ['Rank', 'Key', 'Summary', 'WSJF Score', 'Cost of Delay', 'Story Points', 'Severity', 'Status'];
                const csv = [
                    headers,
                    ...prioritizedTickets.map((t, i) => [
                        i + 1,
                        t.key,
                        `"${t.summary}"`,
                        t.wsjfScore,
                        t.costOfDelay,
                        t.storyPoints,
                        t.severity,
                        t.status
                    ])
                ].map(row => row.join(',')).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `wsjf_export_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                showNotification('Export completed');
            };
            
            return (
                <div className="app-container">
                    {notification && (
                        <Notification
                            message={notification.message}
                            type={notification.type}
                            onClose={() => setNotification(null)}
                        />
                    )}
                    
                    <div className="header">
                        <h1>WSJF Prioritization System</h1>
                        <div className="header-stats">
                            <div className="header-stat">
                                <div className="header-stat-value">{tickets.length}</div>
                                <div className="header-stat-label">Total Tickets</div>
                            </div>
                            <div className="header-stat">
                                <div className="header-stat-value">{stats.avgWSJF.toFixed(1)}</div>
                                <div className="header-stat-label">Avg WSJF Score</div>
                            </div>
                            <div className="header-stat">
                                <div className="header-stat-value">{stats.critical}</div>
                                <div className="header-stat-label">Critical Issues</div>
                            </div>
                            <div className="header-stat">
                                <div className="header-stat-value">{stats.totalPoints}</div>
                                <div className="header-stat-label">Story Points</div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'dashboard' ? 'active' : ''}`}
                            onClick={() => setActiveTab('dashboard')}
                        >
                            üìä Dashboard
                        </button>
                        <button 
                            className={`tab ${activeTab === 'import' ? 'active' : ''}`}
                            onClick={() => setActiveTab('import')}
                        >
                            üì• Import from JIRA
                        </button>
                        <button 
                            className={`tab ${activeTab === 'add' ? 'active' : ''}`}
                            onClick={() => setActiveTab('add')}
                        >
                            ‚ûï Add Ticket
                        </button>
                        <button 
                            className={`tab ${activeTab === 'config' ? 'active' : ''}`}
                            onClick={() => setActiveTab('config')}
                        >
                            ‚öôÔ∏è Configuration
                        </button>
                    </div>
                    
                    <div className="content">
                        {loading && (
                            <div className="loading">
                                <div className="spinner"></div>
                                <p>Loading...</p>
                            </div>
                        )}
                        
                        {!loading && activeTab === 'dashboard' && (
                            <div>
                                <h2 className="section-title">Priority Dashboard</h2>
                                
                                <div className="mode-toggle">
                                    <span style={{ fontWeight: 600, marginRight: 10 }}>Mode:</span>
                                    <button 
                                        className={`mode-btn ${mode === 'demo' ? 'active' : ''}`}
                                        onClick={() => handleModeChange('demo')}
                                    >
                                        Demo Mode
                                    </button>
                                    <button 
                                        className={`mode-btn ${mode === 'jira' ? 'active' : ''}`}
                                        onClick={() => handleModeChange('jira')}
                                    >
                                        JIRA Integration
                                    </button>
                                    <span className={`api-status ${apiConnected ? 'connected' : 'disconnected'}`}>
                                        API: {apiConnected ? '‚úì Connected' : '‚úó Not Connected'}
                                    </span>
                                </div>
                                
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.total}</div>
                                        <div className="stat-label">Total Tickets</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.avgWSJF.toFixed(1)}</div>
                                        <div className="stat-label">Average WSJF</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.totalPoints}</div>
                                        <div className="stat-label">Total Points</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.critical}</div>
                                        <div className="stat-label">Critical/Fire</div>
                                    </div>
                                </div>
                                
                                <div style={{ marginBottom: '20px' }}>
                                    <button className="btn btn-success" onClick={exportToCSV}>
                                        üì• Export to CSV
                                    </button>
                                </div>
                                
                                <table className="table">
                                    <thead>
                                        <tr>
                                            <th>Rank</th>
                                            <th>Key</th>
                                            <th>Summary</th>
                                            <th>WSJF Score</th>
                                            <th>Cost of Delay</th>
                                            <th>Points</th>
                                            <th>Severity</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {prioritizedTickets.map((ticket, index) => (
                                            <tr key={ticket.key}>
                                                <td><strong>#{index + 1}</strong></td>
                                                <td><strong>{ticket.key}</strong></td>
                                                <td>{ticket.summary}</td>
                                                <td><strong style={{ color: '#667eea' }}>{ticket.wsjfScore}</strong></td>
                                                <td>{ticket.costOfDelay}</td>
                                                <td>{ticket.storyPoints}</td>
                                                <td>
                                                    <span className={`badge ${getSeverityBadgeClass(ticket.severity)}`}>
                                                        {ticket.severity.split(' - ')[1]}
                                                    </span>
                                                </td>
                                                <td>{ticket.status}</td>
                                                <td>
                                                    <button
                                                        className="btn btn-danger"
                                                        style={{ padding: '6px 12px', fontSize: '12px' }}
                                                        onClick={() => handleDeleteTicket(ticket.key)}
                                                    >
                                                        Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                        
                        {!loading && activeTab === 'import' && (
                            <div>
                                <h2 className="section-title">Import from JIRA</h2>
                                
                                {mode === 'demo' && (
                                    <div className="alert alert-warning">
                                        ‚ö†Ô∏è Currently in Demo Mode. Switch to JIRA Integration mode to import real tickets.
                                    </div>
                                )}
                                
                                {mode === 'jira' && !apiConnected && (
                                    <div className="alert alert-warning">
                                        ‚ö†Ô∏è JIRA API not connected. Imports will use demo data. Deploy the backend API to enable real JIRA integration.
                                    </div>
                                )}
                                
                                <div className="grid grid-2">
                                    <div className="card">
                                        <h3 className="card-title">Import by Issue Keys</h3>
                                        <div className="form-group">
                                            <label className="form-label">Enter JIRA Issue Keys (comma-separated)</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                placeholder="e.g., PROD-1234, PROD-1235"
                                                value={importKeys}
                                                onChange={(e) => setImportKeys(e.target.value)}
                                            />
                                        </div>
                                        <button 
                                            className="btn btn-primary" 
                                            onClick={handleImportByKeys}
                                            disabled={loading}
                                        >
                                            Import Tickets
                                        </button>
                                    </div>
                                    
                                    <div className="card">
                                        <h3 className="card-title">Import by JQL Query</h3>
                                        <div className="form-group">
                                            <label className="form-label">Enter JQL Query</label>
                                            <textarea
                                                className="form-textarea"
                                                placeholder="project = PROD AND status = 'In Progress'"
                                                value={jqlQuery}
                                                onChange={(e) => setJqlQuery(e.target.value)}
                                            />
                                        </div>
                                        <button 
                                            className="btn btn-primary" 
                                            onClick={handleImportByJQL}
                                            disabled={loading}
                                        >
                                            Import via JQL
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="alert alert-info" style={{ marginTop: '20px' }}>
                                    <strong>JQL Examples:</strong><br/>
                                    ‚Ä¢ project = PROD AND status = "In Progress"<br/>
                                    ‚Ä¢ assignee = currentUser() AND priority = High<br/>
                                    ‚Ä¢ issuetype = Bug AND created >= -7d<br/>
                                    ‚Ä¢ labels in (customer-reported, critical)
                                </div>
                            </div>
                        )}
                        
                        {!loading && activeTab === 'add' && (
                            <div>
                                <h2 className="section-title">Add New Ticket</h2>
                                
                                <div className="card">
                                    <div className="grid grid-2">
                                        <div className="form-group">
                                            <label className="form-label">Ticket Key *</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                placeholder="e.g., PROD-1234"
                                                value={manualTicket.key}
                                                onChange={(e) => setManualTicket({...manualTicket, key: e.target.value})}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Issue Type</label>
                                            <select
                                                className="form-select"
                                                value={manualTicket.issueType}
                                                onChange={(e) => setManualTicket({...manualTicket, issueType: e.target.value})}
                                            >
                                                <option>Bug</option>
                                                <option>Improvement</option>
                                                <option>New Feature</option>
                                                <option>Task</option>
                                                <option>Variable</option>
                                                <option>CleanUp</option>
