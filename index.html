<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSJF Enterprise System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }
        
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .auth-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 420px;
            padding: 40px;
        }
        
        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        .auth-input-group {
            margin-bottom: 20px;
        }
        
        .auth-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .auth-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .auth-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #718096;
        }
        
        .auth-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        
        .app-container {
            min-height: 100vh;
            background: #f0f2f5;
        }
        
        .app-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .app-title {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }
        
        .status-indicators {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #718096;
            margin-left: 40px;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logout-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            color: #4a5568;
            font-size: 14px;
            cursor: pointer;
        }
        
        .nav-tabs {
            background: white;
            padding: 0 24px;
            display: flex;
            gap: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .nav-tab {
            padding: 16px 20px;
            border: none;
            background: transparent;
            color: #718096;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .content-area {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
        }
        
        .stat-label {
            font-size: 13px;
            color: #718096;
            text-transform: uppercase;
            margin-top: 4px;
        }
        
        .action-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }
        
        .filter-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .filter-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 150px;
        }
        
        .filter-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 6px;
            text-transform: uppercase;
        }
        
        .filter-input, .filter-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .data-table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .table-header {
            padding: 16px 20px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #f7fafc;
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #4a5568;
            text-transform: uppercase;
            border-bottom: 2px solid #e2e8f0;
            cursor: pointer;
        }
        
        .data-table td {
            padding: 12px 16px;
            font-size: 14px;
            color: #2d3748;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .data-table tr:hover {
            background: #f7fafc;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }
        
        .badge-fire { background: #f56565; }
        .badge-critical { background: #ed8936; }
        .badge-high { background: #ecc94b; }
        .badge-medium { background: #4299e1; }
        .badge-low { background: #a0aec0; }
        
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select, .form-textarea {
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-left: 4px solid #48bb78;
            z-index: 1000;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }
        
        .column-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f7fafc;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .formula-box {
            background: #edf2f7;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            font-family: monospace;
            font-size: 13px;
            margin-bottom: 25px;
        }
        
        .config-row {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .field-mapping-row {
            display: grid;
            grid-template-columns: 1fr 1fr auto auto;
            gap: 12px;
            padding: 16px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // Services
        const authService = {
            currentUser: JSON.parse(localStorage.getItem('wsjf_user') || 'null'),
            login: (email, password) => {
                if (email && password) {
                    const user = { email, name: email.split('@')[0], role: 'Admin' };
                    localStorage.setItem('wsjf_user', JSON.stringify(user));
                    return user;
                }
                return null;
            },
            signup: (data) => {
                const user = { ...data, role: 'User' };
                localStorage.setItem('wsjf_user', JSON.stringify(user));
                return user;
            },
            logout: () => {
                localStorage.removeItem('wsjf_user');
            }
        };
        
        const dataService = {
            tickets: JSON.parse(localStorage.getItem('wsjf_tickets') || '[]'),
            config: JSON.parse(localStorage.getItem('wsjf_config') || JSON.stringify({
                severityScores: {
                    'Level 5 - FIRE': 21,
                    'Level 4 - Critical': 13,
                    'Level 3 - High': 8,
                    'Level 2 - Medium': 5,
                    'Level 1 - Low': 3
                },
                weights: {
                    businessValue: 0.4,
                    timeCriticality: 0.3,
                    rrOe: 0.3
                },
                jiraJQL: 'project = DEMO AND status != Done'
            })),
            lastSync: JSON.parse(localStorage.getItem('wsjf_sync') || JSON.stringify({
                lastImport: null,
                lastCalc: null,
                importedBy: null,
                calcBy: null
            })),
            columns: [
                { id: 'rank', name: 'Rank', visible: true },
                { id: 'key', name: 'Key', visible: true },
                { id: 'summary', name: 'Summary', visible: true },
                { id: 'wsjfScore', name: 'WSJF Score', visible: true },
                { id: 'costOfDelay', name: 'Cost of Delay', visible: true },
                { id: 'storyPoints', name: 'Points', visible: true },
                { id: 'severity', name: 'Severity', visible: true },
                { id: 'status', name: 'Status', visible: true },
                { id: 'customer', name: 'Customer', visible: true },
                { id: 'team', name: 'Team', visible: true },
                { id: 'actions', name: 'Actions', visible: true }
            ],
            saveTickets: function(tickets) {
                this.tickets = tickets;
                localStorage.setItem('wsjf_tickets', JSON.stringify(tickets));
            },
            saveConfig: function(config) {
                this.config = config;
                localStorage.setItem('wsjf_config', JSON.stringify(config));
            },
            saveSync: function(sync) {
                this.lastSync = sync;
                localStorage.setItem('wsjf_sync', JSON.stringify(sync));
            },
            calculateWSJF: function(ticket, config) {
                const severity = config.severityScores[ticket.severity] || 0;
                const clientBonus = (ticket.issueValue || 0) / 1000;
                const tierBonus = ticket.enterpriseAccounts > 0 ? (ticket.flaggedAccounts > 0 ? 5 : 2) : (ticket.flaggedAccounts > 0 ? 3 : 0);
                const businessValue = (severity + clientBonus + tierBonus) * config.weights.businessValue;
                const timeCriticality = 10 * config.weights.timeCriticality;
                const rrOe = (ticket.rrOeValue || 5) * config.weights.rrOe;
                const costOfDelay = Math.round(businessValue + timeCriticality + rrOe);
                const wsjfScore = (costOfDelay / (ticket.storyPoints || 1)) * 10;
                return { wsjfScore: wsjfScore.toFixed(2), costOfDelay };
            }
        };
        
        // Initialize with sample data if empty
        if (dataService.tickets.length === 0) {
            dataService.tickets = [
                {
                    key: 'DEMO-1001',
                    summary: 'Critical payment gateway timeout',
                    severity: 'Level 5 - FIRE',
                    issueValue: 75000,
                    enterpriseAccounts: 12,
                    flaggedAccounts: 5,
                    rrOeValue: 13,
                    storyPoints: 8,
                    status: 'In Progress',
                    customer: 'Enterprise Corp',
                    team: 'Backend'
                },
                {
                    key: 'DEMO-1002',
                    summary: 'Dashboard performance optimization',
                    severity: 'Level 3 - High',
                    issueValue: 25000,
                    enterpriseAccounts: 3,
                    flaggedAccounts: 1,
                    rrOeValue: 5,
                    storyPoints: 5,
                    status: 'To Do',
                    customer: 'Multiple',
                    team: 'Frontend'
                },
                {
                    key: 'DEMO-1003',
                    summary: 'GDPR compliance module',
                    severity: 'Level 4 - Critical',
                    issueValue: 50000,
                    enterpriseAccounts: 8,
                    flaggedAccounts: 3,
                    rrOeValue: 8,
                    storyPoints: 13,
                    status: 'In Review',
                    customer: 'EU Clients',
                    team: 'Compliance'
                }
            ];
            dataService.saveTickets(dataService.tickets);
        }
        
        // Components
        function LoginForm({ onLogin, onSwitch }) {
            const [email, setEmail] = useState('demo@company.com');
            const [password, setPassword] = useState('demo123');
            
            return (
                <div className="auth-container">
                    <div className="auth-card">
                        <div className="auth-logo">
                            <h1>WSJF Enterprise</h1>
                            <p>Prioritization System</p>
                        </div>
                        <form onSubmit={(e) => {
                            e.preventDefault();
                            const user = authService.login(email, password);
                            if (user) onLogin(user);
                        }}>
                            <div className="auth-input-group">
                                <label className="auth-label">Email</label>
                                <input
                                    type="email"
                                    className="auth-input"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="auth-input-group">
                                <label className="auth-label">Password</label>
                                <input
                                    type="password"
                                    className="auth-input"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            <button type="submit" className="auth-btn">Sign In</button>
                        </form>
                        <div className="auth-link">
                            Don't have an account? <a onClick={onSwitch}>Sign Up</a>
                        </div>
                    </div>
                </div>
            );
        }
        
        function SignupForm({ onSignup, onSwitch }) {
            const [formData, setFormData] = useState({ name: '', email: '', password: '', company: '' });
            
            return (
                <div className="auth-container">
                    <div className="auth-card">
                        <div className="auth-logo">
                            <h1>WSJF Enterprise</h1>
                            <p>Create Account</p>
                        </div>
                        <form onSubmit={(e) => {
                            e.preventDefault();
                            const user = authService.signup(formData);
                            if (user) onSignup(user);
                        }}>
                            <div className="auth-input-group">
                                <label className="auth-label">Name</label>
                                <input
                                    type="text"
                                    className="auth-input"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="auth-input-group">
                                <label className="auth-label">Company</label>
                                <input
                                    type="text"
                                    className="auth-input"
                                    value={formData.company}
                                    onChange={(e) => setFormData({...formData, company: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="auth-input-group">
                                <label className="auth-label">Email</label>
                                <input
                                    type="email"
                                    className="auth-input"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="auth-input-group">
                                <label className="auth-label">Password</label>
                                <input
                                    type="password"
                                    className="auth-input"
                                    value={formData.password}
                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    required
                                />
                            </div>
                            <button type="submit" className="auth-btn">Create Account</button>
                        </form>
                        <div className="auth-link">
                            Already have an account? <a onClick={onSwitch}>Sign In</a>
                        </div>
                    </div>
                </div>
            );
        }
        
        function ColumnManager({ columns, onClose, onSave }) {
            const [cols, setCols] = useState([...columns]);
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h3>Manage Columns</h3>
                            <button onClick={onClose}>×</button>
                        </div>
                        <div className="modal-body">
                            {cols.map(col => (
                                <div key={col.id} className="column-item">
                                    <input
                                        type="checkbox"
                                        checked={col.visible}
                                        onChange={(e) => {
                                            const updated = cols.map(c => 
                                                c.id === col.id ? {...c, visible: e.target.checked} : c
                                            );
                                            setCols(updated);
                                        }}
                                    />
                                    <span>{col.name}</span>
                                </div>
                            ))}
                            <div style={{ marginTop: 20, display: 'flex', gap: 10 }}>
                                <button className="btn btn-primary" onClick={() => onSave(cols)}>Save</button>
                                <button className="btn btn-secondary" onClick={onClose}>Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        function MainApp({ user, onLogout }) {
            const [tab, setTab] = useState('dashboard');
            const [tickets, setTickets] = useState(dataService.tickets);
            const [config, setConfig] = useState(dataService.config);
            const [sync, setSync] = useState(dataService.lastSync);
            const [columns, setColumns] = useState(dataService.columns);
            const [showColManager, setShowColManager] = useState(false);
            const [notification, setNotification] = useState(null);
            const [filters, setFilters] = useState({
                search: '',
                severity: '',
                status: '',
                team: '',
                customer: '',
                operator: 'contains'
            });
            
            const showNotif = (msg) => {
                setNotification(msg);
                setTimeout(() => setNotification(null), 3000);
            };
            
            const handleImport = () => {
                const newTicket = {
                    key: `JIRA-${Date.now()}`,
                    summary: 'Imported from JIRA: ' + config.jiraJQL,
                    severity: 'Level 3 - High',
                    issueValue: 30000,
                    enterpriseAccounts: 4,
                    flaggedAccounts: 2,
                    rrOeValue: 6,
                    storyPoints: 5,
                    status: 'To Do',
                    customer: 'New Client',
                    team: 'Backend'
                };
                const updated = [...tickets, newTicket];
                setTickets(updated);
                dataService.saveTickets(updated);
                const newSync = {...sync, lastImport: new Date().toISOString(), importedBy: user.name};
                setSync(newSync);
                dataService.saveSync(newSync);
                showNotif('Imported 1 ticket from JIRA');
            };
            
            const handleRecalc = () => {
                const newSync = {...sync, lastCalc: new Date().toISOString(), calcBy: user.name};
                setSync(newSync);
                dataService.saveSync(newSync);
                setTickets([...tickets]); // Force re-render
                showNotif('Recalculated WSJF scores');
            };
            
            const handleDelete = (key) => {
                const updated = tickets.filter(t => t.key !== key);
                setTickets(updated);
                dataService.saveTickets(updated);
                showNotif('Ticket deleted');
            };
            
            const handleSaveColumns = (cols) => {
                setColumns(cols);
                setShowColManager(false);
                showNotif('Column settings saved');
            };
            
            const formatTime = (iso) => {
                if (!iso) return 'Never';
                const diff = Date.now() - new Date(iso).getTime();
                const mins = Math.floor(diff / 60000);
                if (mins < 60) return `${mins}m ago`;
                return `${Math.floor(mins / 60)}h ago`;
            };
            
            const processedTickets = useMemo(() => {
                let result = tickets.map(t => ({
                    ...t,
                    ...dataService.calculateWSJF(t, config)
                }));
                
                // Apply filters
                if (filters.search) {
                    const s = filters.search.toLowerCase();
                    if (filters.operator === 'contains') {
                        result = result.filter(t => 
                            t.key.toLowerCase().includes(s) || 
                            t.summary.toLowerCase().includes(s)
                        );
                    }
                }
                if (filters.severity) result = result.filter(t => t.severity === filters.severity);
                if (filters.status) result = result.filter(t => t.status === filters.status);
                if (filters.team) result = result.filter(t => t.team === filters.team);
                if (filters.customer) result = result.filter(t => t.customer?.toLowerCase().includes(filters.customer.toLowerCase()));
                
                // Sort by WSJF
                result.sort((a, b) => parseFloat(b.wsjfScore) - parseFloat(a.wsjfScore));
                return result;
            }, [tickets, config, filters]);
            
            const stats = {
                total: processedTickets.length,
                avgWSJF: processedTickets.reduce((sum, t) => sum + parseFloat(t.wsjfScore), 0) / processedTickets.length || 0,
                points: processedTickets.reduce((sum, t) => sum + (t.storyPoints || 0), 0),
                critical: processedTickets.filter(t => t.severity.includes('Critical') || t.severity.includes('FIRE')).length
            };
            
            const visibleCols = columns.filter(c => c.visible);
            
            return (
                <div className="app-container">
                    {notification && <div className="notification">{notification}</div>}
                    
                    <div className="app-header">
                        <div style={{ display: 'flex', alignItems: 'center' }}>
                            <h1 className="app-title">WSJF Enterprise</h1>
                            <div className="status-indicators">
                                <span>Import: {formatTime(sync.lastImport)} {sync.importedBy && `by ${sync.importedBy}`}</span>
                                <span>Calc: {formatTime(sync.lastCalc)} {sync.calcBy && `by ${sync.calcBy}`}</span>
                            </div>
                        </div>
                        <div className="user-menu">
                            <span>{user.name} ({user.role})</span>
                            <button className="logout-btn" onClick={onLogout}>Logout</button>
                        </div>
                    </div>
                    
                    <div className="nav-tabs">
                        <button className={`nav-tab ${tab === 'dashboard' ? 'active' : ''}`} onClick={() => setTab('dashboard')}>
                            Dashboard
                        </button>
                        <button className={`nav-tab ${tab === 'field-mapper' ? 'active' : ''}`} onClick={() => setTab('field-mapper')}>
                            Field Mapper
                        </button>
                        <button className={`nav-tab ${tab === 'jira-config' ? 'active' : ''}`} onClick={() => setTab('jira-config')}>
                            JIRA Config
                        </button>
                        <button className={`nav-tab ${tab === 'scoring' ? 'active' : ''}`} onClick={() => setTab('scoring')}>
                            Scoring Engine
                        </button>
                        <button className={`nav-tab ${tab === 'api' ? 'active' : ''}`} onClick={() => setTab('api')}>
                            API Settings
                        </button>
                    </div>
                    
                    <div className="content-area">
                        {tab === 'dashboard' && (
                            <>
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.total}</div>
                                        <div className="stat-label">Total Tickets</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.avgWSJF.toFixed(1)}</div>
                                        <div className="stat-label">Avg WSJF</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.points}</div>
                                        <div className="stat-label">Story Points</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">{stats.critical}</div>
                                        <div className="stat-label">Critical</div>
                                    </div>
                                </div>
                                
                                <div className="action-bar">
                                    <button className="btn btn-primary" onClick={handleImport}>📥 Import from JIRA</button>
                                    <button className="btn btn-success" onClick={handleRecalc}>🔄 Recalculate</button>
                                    <button className="btn btn-secondary" onClick={() => {
                                        const csv = [
                                            visibleCols.map(c => c.name),
                                            ...processedTickets.map((t, i) => 
                                                visibleCols.map(c => {
                                                    if (c.id === 'rank') return i + 1;
                                                    if (c.id === 'actions') return '';
                                                    return t[c.id] || '';
                                                })
                                            )
                                        ].map(r => r.join(',')).join('\n');
                                        
                                        const blob = new Blob([csv], { type: 'text/csv' });
                                        const a = document.createElement('a');
                                        a.href = URL.createObjectURL(blob);
                                        a.download = 'wsjf.csv';
                                        a.click();
                                        showNotif('Exported to CSV');
                                    }}>📤 Export</button>
                                </div>
                                
                                <div className="filter-bar">
                                    <div className="filter-row">
                                        <div className="filter-group">
                                            <label className="filter-label">Search</label>
                                            <input
                                                className="filter-input"
                                                value={filters.search}
                                                onChange={(e) => setFilters({...filters, search: e.target.value})}
                                            />
                                        </div>
                                        <div className="filter-group">
                                            <label className="filter-label">Operator</label>
                                            <select
                                                className="filter-select"
                                                value={filters.operator}
                                                onChange={(e) => setFilters({...filters, operator: e.target.value})}
                                            >
                                                <option value="contains">Contains</option>
                                                <option value="equals">Equals</option>
                                                <option value="starts">Starts with</option>
                                                <option value="ends">Ends with</option>
                                            </select>
                                        </div>
                                        <div className="filter-group">
                                            <label className="filter-label">Severity</label>
                                            <select
                                                className="filter-select"
                                                value={filters.severity}
                                                onChange={(e) => setFilters({...filters, severity: e.target.value})}
                                            >
                                                <option value="">All</option>
                                                <option value="Level 5 - FIRE">FIRE</option>
                                                <option value="Level 4 - Critical">Critical</option>
                                                <option value="Level 3 - High">High</option>
                                                <option value="Level 2 - Medium">Medium</option>
                                                <option value="Level 1 - Low">Low</option>
                                            </select>
                                        </div>
                                        <div className="filter-group">
                                            <label className="filter-label">Status</label>
                                            <select
                                                className="filter-select"
                                                value={filters.status}
                                                onChange={(e) => setFilters({...filters, status: e.target.value})}
                                            >
                                                <option value="">All</option>
                                                <option value="To Do">To Do</option>
                                                <option value="In Progress">In Progress</option>
                                                <option value="In Review">In Review</option>
                                            </select>
                                        </div>
                                        <div className="filter-group">
                                            <label className="filter-label">Team</label>
                                            <select
                                                className="filter-select"
                                                value={filters.team}
                                                onChange={(e) => setFilters({...filters, team: e.target.value})}
                                            >
                                                <option value="">All</option>
                                                <option value="Backend">Backend</option>
                                                <option value="Frontend">Frontend</option>
                                                <option value="Compliance">Compliance</option>
                                            </select>
                                        </div>
                                        <div className="filter-group">
                                            <button className="btn btn-secondary" onClick={() => setFilters({
                                                search: '', severity: '', status: '', team: '', customer: '', operator: 'contains'
                                            })}>Clear</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="data-table-container">
                                    <div className="table-header">
                                        <h3>Prioritized Tickets</h3>
                                        <button onClick={() => setShowColManager(true)}>⚙️ Columns</button>
                                    </div>
                                    <table className="data-table">
                                        <thead>
                                            <tr>
                                                {visibleCols.map(col => (
                                                    <th key={col.id}>{col.name}</th>
                                                ))}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {processedTickets.map((t, i) => (
                                                <tr key={t.key}>
                                                    {visibleCols.map(col => {
                                                        if (col.id === 'rank') return <td key={col.id}>#{i + 1}</td>;
                                                        if (col.id === 'severity') return (
                                                            <td key={col.id}>
                                                                <span className={`badge badge-${t.severity.split(' - ')[1].toLowerCase()}`}>
                                                                    {t.severity.split(' - ')[1]}
                                                                </span>
                                                            </td>
                                                        );
                                                        if (col.id === 'actions') return (
                                                            <td key={col.id}>
                                                                <button onClick={() => handleDelete(t.key)}>Delete</button>
                                                            </td>
                                                        );
                                                        return <td key={col.id}>{t[col.id] || '-'}</td>;
                                                    })}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                
                                {showColManager && (
                                    <ColumnManager
                                        columns={columns}
                                        onClose={() => setShowColManager(false)}
                                        onSave={handleSaveColumns}
                                    />
                                )}
                            </>
                        )}
                        
                        {tab === 'field-mapper' && (
                            <div className="form-section">
                                <h2>Field Mapping Configuration</h2>
                                <p>Configure JIRA field mappings for WSJF calculations</p>
                                <div style={{ marginTop: 20 }}>
                                    <h3>Standard Fields</h3>
                                    {['severity', 'issueValue', 'enterpriseAccounts', 'flaggedAccounts', 'storyPoints'].map(field => (
                                        <div key={field} className="field-mapping-row">
                                            <div>{field}</div>
                                            <input className="form-input" placeholder="JIRA field ID" />
                                            <select className="form-select">
                                                <option>Text</option>
                                                <option>Number</option>
                                                <option>Dropdown</option>
                                            </select>
                                        </div>
                                    ))}
                                    <button className="btn btn-primary" style={{ marginTop: 20 }}>+ Add Custom Field</button>
                                </div>
                            </div>
                        )}
                        
                        {tab === 'jira-config' && (
                            <div className="form-section">
                                <h2>JIRA Configuration</h2>
                                <div className="form-group">
                                    <label className="form-label">Default JQL Query</label>
                                    <textarea
                                        className="form-textarea"
                                        value={config.jiraJQL}
                                        onChange={(e) => {
                                            const updated = {...config, jiraJQL: e.target.value};
                                            setConfig(updated);
                                            dataService.saveConfig(updated);
                                        }}
                                    />
                                </div>
                                <h3>Query Templates</h3>
                                {[
                                    { name: 'All Open', jql: 'status != Done' },
                                    { name: 'High Priority', jql: 'priority = High' },
                                    { name: 'Current Sprint', jql: 'sprint in openSprints()' }
                                ].map(t => (
                                    <div key={t.name} style={{ padding: 10, background: '#f7fafc', marginBottom: 10, borderRadius: 6 }}>
                                        <strong>{t.name}:</strong> {t.jql}
                                        <button 
                                            className="btn btn-secondary" 
                                            style={{ float: 'right', padding: '4px 8px' }}
                                            onClick={() => {
                                                const updated = {...config, jiraJQL: t.jql};
                                                setConfig(updated);
                                                dataService.saveConfig(updated);
                                                showNotif('Template applied');
                                            }}
                                        >Use</button>
                                    </div>
                                ))}
                            </div>
                        )}
                        
                        {tab === 'scoring' && (
                            <div className="form-section">
                                <h2>Scoring Engine Configuration</h2>
                                <div className="formula-box">
                                    <strong>WSJF = (Cost of Delay ÷ Job Size) × 10</strong><br/>
                                    Cost of Delay = Business Value + Time Criticality + RR/OE
                                </div>
                                <h3>Severity Scores</h3>
                                {Object.entries(config.severityScores).map(([level, score]) => (
                                    <div key={level} className="config-row">
                                        <span>{level}</span>
                                        <input
                                            type="number"
                                            value={score}
                                            onChange={(e) => {
                                                const updated = {
                                                    ...config,
                                                    severityScores: {...config.severityScores, [level]: parseInt(e.target.value)}
                                                };
                                                setConfig(updated);
                                                dataService.saveConfig(updated);
                                            }}
                                            style={{ width: 80, padding: 8 }}
                                        />
                                    </div>
                                ))}
                                <h3>Component Weights</h3>
                                {Object.entries(config.weights).map(([key, val]) => (
                                    <div key={key} className="config-row">
                                        <span>{key}</span>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={val}
                                            onChange={(e) => {
                                                const updated = {
                                                    ...config,
                                                    weights: {...config.weights, [key]: parseFloat(e.target.value)}
                                                };
                                                setConfig(updated);
                                                dataService.saveConfig(updated);
                                            }}
                                            style={{ width: 80, padding: 8 }}
                                        />
                                    </div>
                                ))}
                            </div>
                        )}
                        
                        {tab === 'api' && (
                            <div className="form-section">
                                <h2>API Settings</h2>
                                <div className="form-grid">
                                    <div className="form-group">
                                        <label className="form-label">JIRA URL</label>
                                        <input className="form-input" placeholder="https://company.atlassian.net" />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Email</label>
                                        <input className="form-input" type="email" placeholder="email@company.com" />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">API Token</label>
                                        <input className="form-input" type="password" placeholder="Your API token" />
                                    </div>
                                </div>
                                <button className="btn btn-primary" onClick={() => showNotif('API settings saved')}>
                                    Save & Test Connection
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        function App() {
            const [user, setUser] = useState(authService.currentUser);
            const [showSignup, setShowSignup] = useState(false);
            
            if (!user) {
                if (showSignup) {
                    return <SignupForm onSignup={setUser} onSwitch={() => setShowSignup(false)} />;
                }
                return <LoginForm onLogin={setUser} onSwitch={() => setShowSignup(true)} />;
            }
            
            return <MainApp user={user} onLogout={() => {
                authService.logout();
                setUser(null);
            }} />;
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
